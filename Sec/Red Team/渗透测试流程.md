#### 1.明确目标

1）**确定范围**：测试的范围，如：IP、域名、内外网、整站or部分模块
2）**确定规则**：能渗透到什么程度（发现漏洞为止or继续利用漏洞）、时间限制、能否修改上传、能否提权...

- 目标系统介绍、重点保护对象及特性。
- 是否允许数据破坏？
- 是否允许阻断业务正常运行？
- 测试之前是否应当知会相关部门接口人？
- 接入方式？外网和内网？
- 测试是发现问题就算成功，还是尽可能的发现多的问题？
- 渗透过程是否需要考虑社会工程？

3）**确定需求**：web应用的漏洞(新上线程序)？业务逻辑漏洞（针对业务的）？人员权限管理漏洞（针对人员、权限）？
根据需求和自己技术能力来确定能不能做、能做多少

#### 2.分析风险，获得授权

分析渗透测试过程中可能产生的风险，如大量测试数据的处理、影响正常业务开展、服务器发生异常的应急、数据备份和恢复、测试人力物力成本...
由测试方书写实施方案初稿并提交给客户（or本公司内部领导）进行审核。在审核完成后，从客户（or本公司内部领导）获取对测试方进行书面委托授权书，授权测试方进行渗透测试。

#### 3.信息收集

在信息收集阶段，我们需要尽量多的收集关于目标web应用的各种信息，比如：脚本语言的类型、服务器的类型、目录的结构、使用的开源软件、数据库类型、所有链接页面，用到的框架等。
**方式**：主动扫描；开放搜索
**开放搜索**：利用搜索引擎获得后台、未授权页面、敏感url

```
基础信息：IP，网段，域名，端口
系统信息：操作系统版本
应用信息：各端口的应用，例如web应用，邮件应用等
版本信息：所有探测到的版本
服务信息：服务器类型、版本
人员信息：域名注册人员信息，web应用中网站发帖人的id，管理员姓名等
防护信息：试着看能否探测到防护设备
```

 

#### 4.漏洞探测（手动&自动）

利用上一步中列出的信息，使用相应的漏洞检测

**方法：**
1）漏扫：AWVS、AppScan...
2）结合漏洞去exploit-db等位置找利用
3）在网上寻找验证POC

**内容：**
系统漏洞：系统没有及时打补丁
Websever漏洞：Websever配置问题
Web应用漏洞：Web应用开发问题
其它端口服务漏洞：各种21/8080(st2)/7001/22/3389
通信安全：明文传输，token在cookie中传送等

#### 5.漏洞验证

将上一步中发现的有可能可以成功利用的全部漏洞都验证一遍。结合实际情况，搭建模拟环境进行试验，成功后再应用于目标中。

- 自动化验证：结合自动化扫描工具提供的结果

- 手工验证：根据公开资源进行验证

- 试验验证：自己搭建模拟环境进行验证

- 登录猜解：有时可以尝试猜解一下登陆口的账号密码等信息

- 业务漏洞验证：如发现业务漏洞，要进行验证

- 公开资源的利用
  exploit-db/wooyun/
  渗透代码网站
  通用、缺省口令
  厂商的漏洞警告等

  

#### 6.信息分析

为下一步实施渗透做准备

- 精准攻击：准备好上一步探测到的漏洞exp（漏洞利用），用来精准攻击

- 绕过防御机制：是否有防火墙等设备，如何绕过

- 定制攻击路径：最佳工具路径，根据薄弱入口，高内网权限位置，最终目标

- 绕过检测机制：是否有检测机制，流量监控，杀毒软件，恶意代码检测等（免杀）

- 攻击代码：经过试验得来的代码，包括不限于xss代码，sql注入语句等

  

#### 7.利用漏洞，获取数据

- 实施攻击：根据前几步的结果，进行攻击

- 获取内部信息：基础设施（网络连接，vpn，路由，拓扑等）

- 进一步渗透：内网入侵，敏感目标

- 持续性存在：一般对客户做渗透不需要。rookit，后门，添加管理账号，驻扎手法等

- 清理痕迹：清理相关日志（访问，操作），上传文件等

  

#### 8.信息整理

- 整理渗透工具：整理渗透过程中用到的代码，poc，exp等

- 整理收集信息：整理渗透过程中收集到的一切信息

- 整理漏洞信息：整理渗透过程中遇到的各种漏洞，各种脆弱位置信息
  目的：为了最后形成报告，形成测试结果使用。

  

#### 9.形成报告

- - 按需整理：按照之前第一步跟客户确定好的范围，需求来整理资料，并将资料形成报告
  - 补充介绍：要对漏洞成因，验证过程和带来危害进行分析
  - 修补建议：当然要对所有产生的问题提出合理高效安全的解决办法

 

# 渗透测试

![在这里插入图片描述](https://img-blog.csdnimg.cn/20190311222441695.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM1MDk3OTQz,size_16,color_FFFFFF,t_70)

## 渗透测试

渗透测试就是利用我们所掌握的渗透知识，对一个网站进行一步一步的渗透，发现其中存在的漏洞和隐藏的风险，然后撰写一篇测试报告，提供给我们的客户。客户根据我们撰写的测试报告，对网站进行漏洞修补，以防止黑客的入侵！

渗透测试的前提是我们得经过用户的授权，才可以对网站进行渗透。如果我们没有经过客户的授权而对一个网站进行渗透测试的话，这是违法的。去年的6.1日我国颁布了《网络安全法》，对网络犯罪有了法律约束，不懂的移步——> 网络安全法

渗透测试分为 白盒测试 和 黑盒测试

白盒测试就是在知道目标网站源码和其他一些信息的情况下对其进行渗透，有点类似于代码分析

黑盒测试就是只告诉我们这个网站的url，其他什么都不告诉，然后让你去渗透，模拟黑客对网站的渗透

我们现在就模拟黑客对一个网站进行渗透测试，这属于黑盒测试，我们只知道该网站的URL，其他什么的信息都不知道。

接下来，我就给大家分享下黑盒渗透测试的流程和思路！

当我们确定好了一个目标进行渗透之后，第一步该做的是什么呢？

## 信息收集

第一步做的就是信息收集，正所谓知己知彼百战百胜，我们根据网站URL可以查出一系列关于该网站的信息。通过URL我们可以查到该网站的IP、该网站操作系统、脚本语言、在该服务器上是否还有其他网站等等一些列的信息。更多的关于信息收集，我在另一篇文章中很详细的介绍了信息收集需要收集哪些信息，以及信息收集过程中需要用到的工具，传送门——> 渗透测试之信息收集

## 漏洞探测

当我们收集到了足够多的信息之后，我们就要开始对网站进行漏洞探测了。探测网站是否存在一些常见的Web漏洞，比如：

```
SQL注入，传送门——>SQL注入详解
XSS跨站脚本，传送门——>XSS(跨站脚本)漏洞详解
CSRF跨站请求伪造,  传送门——>CSRF跨站请求伪造攻击
XXE漏洞，传送门——>XXE(XML外部实体注入)漏洞
SSRF服务端请求伪造漏洞，传送门——>SSRF(服务端请求伪造)漏洞
文件包含漏洞,  传送门——>文件包含漏洞
文件上传漏洞, 传送门——>文件上传漏洞
文件解析漏洞，传送门——>文件解析漏洞
远程代码执行漏洞 , 传送门——> 远程代码执行漏洞
CORS跨域资源共享漏洞，传送门——>CORS跨域资源共享漏洞
越权访问漏洞，传送门——>越权访问漏洞
目录浏览漏洞和任意文件读取/下载漏洞，传送门——>目录浏览漏洞和任意文件读取/下载漏洞
struts2漏洞，传送门——>Struts2漏洞
JAVA反序列化漏洞，传送门——>JAVA反序列化漏洞
```

这些是网站经常发现的一些漏洞，还有一些网站漏洞，这里我就不一一列举出来了。

网站漏洞扫描工具也有很多，比如：

```
AWVS  ，传送门——> AWVS扫描器的用法
AppScan ，传送门——> AppScan扫描器的用法
Owasp-Zap ，传送门——> OWASP-ZAP扫描器的使用
Nessus ，传送门——> Nessus扫描器的使用
```

网站漏洞扫描工具我就列举这几种，还有很多，最常用的是这几个！

## 漏洞利用

当我们探测到了该网站存在漏洞之后，我们就要对该漏洞进行利用了。不同的漏洞有不同的利用工具，很多时候，通过一个漏洞我们很难拿到网站的webshell，我们往往需要结合几个漏洞来拿webshell。常用的漏洞利用工具如下：

```
SQL注入 ， 传送门——> Sqlmap的使用

XSS跨站脚本，传送门——> Beef-XSS的使用

抓包改包工具，——> Burpsuite工具的使用  、  Fidder抓包软件的使用

文件上传漏洞，上传漏洞的话，我们一般会上传一句话木马上去，进而再获得webshell，传送门——> Webshell和一句话木马
```

但是，获得了webshell后，一般权限很低，所以我们需要提权， Windows提权 、 Linux下用SUID提权

## 内网转发

当我们获取到了网站的Webshell之后，如果我们还想进一步的探测内网主机的信息的话，我们就需要进行内网转发了。我们是不能直接和内网的主机通信的，所以我们就需要借助获取到的webshell网站的服务器和内网主机进行通信。那么，我们怎么借助网站的服务器和内网通信呢，传送门——> 内网转发

## 内网渗透

当我们能跟内网主机进行通信后，我们就要开始进行内网渗透了。可以先使用nmap对内网主机进行扫描，探测在线的主机，并且探测其使用的操作系统、开放的端口等信息，传送门——> Nmap和Zenmap详解

内网用户基本都是使用的windows系统，而且大多数是使用的windows7，在windows7中有很多漏洞，比如MS17_010这种漏洞，我们可以探测其windows系统是否存在这种漏洞，如果有这种漏洞，直接拿shell。传送门——> Metasploit Framework(MSF)的使用

企业内网大多数是一个域环境。所以，我们只需要找到域控服务器，并拿下其权限，就可以登录其他所有用户的主机了。

当然，内网中也有可能存在供内网使用的内网服务器，我们可以进一步渗透拿下其权限。

至于怎么拿下内网中机器的权限，这要看内网环境了。我这里只是说下大概的一个思路。

## 痕迹清除

当我们达到了目的之后，有时候只是为了黑入网站挂黑页，炫耀一下；或者在网站留下一个后门，作为肉鸡，没事的时候上去溜达溜达；亦或者挂入挖矿木马；但是大家千万不要干这些事，这些都是违法的！

我这里只是教大家在渗透进去之后如何清除我们留下的痕迹，以免被网站管理员发现，

## 撰写渗透测试保告

在完成了渗透测试之后，我们就需要对这次渗透测试撰写渗透测试报告了。明确的写出哪里存在漏洞，以及漏洞修补的方法。以便于网站管理员根据我们的渗透测试报告修补这些漏洞和风险，防止被黑客攻击！